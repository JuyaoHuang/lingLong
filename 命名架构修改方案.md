# 命名架构修改方案

## 一、前端项目重命名方案

### 1.1 重命名影响范围分析

需要修改的地方：

1. **目录名称**：yukina/ → linglong/
2. **Docker 配置**：所有引用 yukina 的路径
3. **后端配置**：环境变量中的路径
4. **Nginx 配置**：挂载路径
5. **前端配置文件**：yukina.config.ts → linglong.config.ts
6. **package.json**：项目名称

### 1.2 重命名步骤

```
# 停止所有容器
docker-compose down

# 重命名目录
cd D:\Coding\Wrote_Codes\webTest
mv yukina linglong

# 重命名配置文件
cd linglong
mv yukina.config.ts linglong.config.ts

# 更新 package.json 中的项目名称
# "name": "yukina" → "name": "linglong"
  
```

### 1.3 需要修改的文件清单

#### 1. package.json

```
{
"name": "linglong",
"type": "module",
"version": "0.0.1"
}
  
```

#### 2. astro.config.mjs

```
import { defineConfig } from 'astro/config';
import linglong from "./linglong.config";  // ✅ 修改导入路径

export default defineConfig({
  site: linglong.site,
  // ...
});
  
```

#### 3. 所有导入 yukina.config 的文件

**批量查找需要修改的文件**

```
cd linglong
grep -r "yukina.config" src/
```

需要修改的典型文件：

- `src/pages/*.astro`
- `src/layouts/*.astro`
- `src/components/**/*.astro`

**修改示例：**

```javascript
// ❌ 旧的
import YukinaConfig from "../yukina.config";

// ✅ 新的
import LinglongConfig from "../linglong.config";  
```

#### 4. docker-compose.yml（根目录）

```yml
    services:
  backend:
    volumes:
      - ./backend/app:/code/app
      - ./backend/data:/code/data
      - ./linglong:/code/linglong              # ✅ yukina → linglong
      - /code/linglong/node_modules            # ✅ yukina → linglong
    environment:
      - ENVIRONMENT=production
      - ASTRO_CONTENT_PATH=/code/linglong/src/contents/posts  # ✅
      - ASTRO_PROJECT_PATH=/code/linglong                     # ✅

  nginx:
    volumes:
      - ./linglong/dist:/usr/share/nginx/html  # ✅ yukina → linglong
  
```

#### 5. backend.Dockerfile（根目录）

```
# 复制前端依赖文件
RUN mkdir -p /code/linglong                                    # ✅
COPY linglong/package.json /code/linglong/package.json        # ✅
COPY linglong/pnpm-lock.yaml /code/linglong/pnpm-lock.yaml    # ✅

# 在构建时安装前端依赖
RUN cd /code/linglong && pnpm install --frozen-lockfile       # ✅
  
```

#### 6. backend/docker-compose.yml

```
    services:
  backend:
    volumes:
      - ./app:/code/app
      - ./data:/code/data
      - ../linglong/src/contents/posts:/code/linglong/src/contents/posts  # ✅
      - ../linglong/src/scripts:/code/linglong/src/scripts                # ✅
      - ../linglong:/code/linglong                                         # ✅
  
```

#### 7. backend/app/core/config.py

```
# 环境变量读取
ASTRO_CONTENT_PATH: Path = Path(
    os.getenv("ASTRO_CONTENT_PATH", "/code/linglong/src/contents/posts")  # ✅
)
ASTRO_PROJECT_PATH: Path = Path(
    os.getenv("ASTRO_PROJECT_PATH", "/code/linglong")  # ✅
)
  
```

------



## 二、环境变量配置方案

### 2.1 .env 文件结构

创建三个环境配置文件：

```
    /webTest/
├── .env                    # 默认配置（开发环境）
├── .env.development        # 开发环境（可选）
├── .env.production         # 生产环境
└── linglong/
    ├── .env                # 前端开发配置
    └── .env.production     # 前端生产配置
  
```

### 2.2 根目录配置文件

#### .env（开发环境默认配置）

```
# ==========================================
# 博客系统环境配置 - 开发环境
# ==========================================

# ========== 项目信息 ==========
PROJECT_NAME=linglong-blog
ENVIRONMENT=development

# ========== 服务端口 ==========
# Nginx 对外端口
NGINX_PORT=8080
# 后端端口（仅容器内部访问）
BACKEND_PORT=8000
# 前端开发服务器端口（本地开发用）
FRONTEND_DEV_PORT=4321

# ========== 网站配置 ==========
# 网站 URL（用于 sitemap、RSS 等）
SITE_URL=http://localhost:8080
# 网站标题
SITE_TITLE=Alen's Blog
# 网站描述
SITE_DESCRIPTION=A personal blog built with Astro and FastAPI

# ========== 数据库配置 ==========
# SQLite 数据库路径（相对于 backend 目录）
DATABASE_PATH=./data/blog.db

# ========== 认证配置 ==========
# JWT Secret Key（开发环境密钥，生产环境务必修改！）
JWT_SECRET_KEY=dev-secret-key-change-in-production
# JWT 过期时间（分钟）
JWT_EXPIRE_MINUTES=1440

# ========== 文件路径配置 ==========
# Astro 项目路径（容器内路径）
ASTRO_PROJECT_PATH=/code/linglong
# Astro 内容目录（容器内路径）
ASTRO_CONTENT_PATH=/code/linglong/src/contents/posts
# 静态文件输出目录（容器内路径）
ASTRO_DIST_PATH=/code/linglong/dist

# ========== CORS 配置 ==========
# 允许的源（逗号分隔）
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:4321,http://localhost:8080

# ========== 日志配置 ==========
LOG_LEVEL=INFO
LOG_FILE=./logs/app.log

# ========== 前端 API 配置 ==========
# 前端 API 基础路径（开发环境直接访问后端）
PUBLIC_API_URL=http://localhost:8000

# ========== Docker 配置 ==========
# Docker Compose 项目名称
COMPOSE_PROJECT_NAME=linglong_blog
  
```

#### .env.production（生产环境配置）

```
    # ==========================================
# 博客系统环境配置 - 生产环境
# ==========================================

# ========== 项目信息 ==========
PROJECT_NAME=linglong-blog
ENVIRONMENT=production

# ========== 服务端口 ==========
# Nginx 对外端口
NGINX_PORT=80
# 后端端口（仅容器内部访问）
BACKEND_PORT=8000

# ========== 网站配置 ==========
# 网站 URL（生产环境域名）
SITE_URL=https://your-domain.com
# 网站标题
SITE_TITLE=Alen's Blog
# 网站描述
SITE_DESCRIPTION=A personal blog built with Astro and FastAPI

# ========== 数据库配置 ==========
# SQLite 数据库路径
DATABASE_PATH=./data/blog.db

# ========== 认证配置 ==========
# JWT Secret Key（务必使用强密钥！）
JWT_SECRET_KEY=CHANGE_THIS_TO_A_STRONG_SECRET_KEY_IN_PRODUCTION
# JWT 过期时间（分钟）
JWT_EXPIRE_MINUTES=1440

# ========== 文件路径配置 ==========
# Astro 项目路径（容器内路径）
ASTRO_PROJECT_PATH=/code/linglong
# Astro 内容目录（容器内路径）
ASTRO_CONTENT_PATH=/code/linglong/src/contents/posts
# 静态文件输出目录（容器内路径）
ASTRO_DIST_PATH=/code/linglong/dist

# ========== CORS 配置 ==========
# 生产环境只允许自己的域名
ALLOWED_ORIGINS=https://your-domain.com

# ========== 日志配置 ==========
LOG_LEVEL=WARNING
LOG_FILE=./logs/app.log

# ========== 前端 API 配置 ==========
# 前端 API 基础路径（生产环境使用相对路径，通过 Nginx 代理）
PUBLIC_API_URL=

# ========== Docker 配置 ==========
# Docker Compose 项目名称
COMPOSE_PROJECT_NAME=linglong_blog

# ========== HTTPS 配置（可选）==========
# SSL 证书路径（如果使用 HTTPS）
SSL_CERT_PATH=/etc/ssl/certs/your-domain.crt
SSL_KEY_PATH=/etc/ssl/private/your-domain.key
  
```

### 2.3 前端配置文件

#### linglong/.env（前端开发环境）

```
    # ==========================================
# Linglong 前端配置 - 开发环境
# ==========================================

# ========== API 配置 ==========
# API 基础路径（开发时直接访问后端）
PUBLIC_API_URL=http://localhost:8000

# ========== 网站配置 ==========
# 网站 URL
SITE_URL=http://localhost:4321
# 或者如果通过 Nginx 访问：
# SITE_URL=http://localhost:8080

# ========== 构建配置 ==========
# 生产构建时是否生成 sitemap
PUBLIC_GENERATE_SITEMAP=true
# 是否启用搜索功能（pagefind）
PUBLIC_ENABLE_SEARCH=true
  
```

#### linglong/.env.production（前端生产环境）

```
    # ==========================================
# Linglong 前端配置 - 生产环境
# ==========================================

# ========== API 配置 ==========
# API 基础路径（生产环境使用相对路径，通过 Nginx 代理）
PUBLIC_API_URL=

# ========== 网站配置 ==========
# 网站 URL（生产域名）
SITE_URL=https://your-domain.com

# ========== 构建配置 ==========
# 生产构建时是否生成 sitemap
PUBLIC_GENERATE_SITEMAP=true
# 是否启用搜索功能（pagefind）
PUBLIC_ENABLE_SEARCH=true

# ========== 性能优化 ==========
# 是否启用图片优化
PUBLIC_OPTIMIZE_IMAGES=true
# 是否压缩 CSS/JS
PUBLIC_MINIFY_ASSETS=true
  
```

### 2.4 修改配置文件以使用环境变量

#### 1. linglong.config.ts



```
import I18nKeys from "./src/locales/keys";
import type { Configuration } from "./src/types/config";

const LinglongConfig: Configuration = {
  title: "",
  subTitle: "",
  brandTitle: "Alen's website",

  description: "",

  // ✅ 使用环境变量
  site: import.meta.env.SITE_URL || process.env.SITE_URL || "http://localhost:8080",

  locale: "en",

  navigators: [
    {
      nameKey: I18nKeys.nav_bar_home,
      href: "/",
    },
    {
      nameKey: I18nKeys.nav_bar_archive,
      href: "/archive",
    },
    {
      nameKey: I18nKeys.nav_bar_about,
      href: "/about",
    },
    {
      nameKey: I18nKeys.nav_bar_github,
      href: "https://github.com/JuyaoHuang",
    },
    {
      nameKey: I18nKeys.nav_bar_friends,
      href: "/friends",
    },
  ],

  username: "わかば むつみ",
  sign: "とある科学のみさか みこと",
  avatarUrl: "/muzimi.png",

  socialLinks: [
    {
      icon: "line-md:github-loop",
      link: "https://github.com/JuyaoHuang",
    },
    {
      icon: "mingcute:bilibili-line",
      link: "https://space.bilibili.com/506080737",
    },
  ],

  maxSidebarCategoryChip: 6,
  maxSidebarTagChip: 9,
  maxFooterCategoryChip: 6,
  maxFooterTagChip: 24,

  banners: [
    "/images/1.png",
    "/images/2.jpg",
    "/images/3.png",
    "/images/4.png",
    "/images/5.jpg",
    "/images/6.jpg",
    "/images/7.png",
    "/images/8.png",
    "/images/9.png",
    "/images/10.jpg",
    "/images/11.jpg",
    "/images/12.png",
  ],

  slugMode: "RAW",

  license: {
    name: "CC BY-NC-SA 4.0",
    url: "https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.en",
  },

  bannerStyle: "loop",
};

export default LinglongConfig;
  
```

#### 2. astro.config.mjs

```
import { defineConfig } from 'astro/config';
import linglong from "./linglong.config";

export default defineConfig({
  // ✅ 使用配置文件中的 site
  site: linglong.site,

  integrations: [
    // ...
  ],

  // 其他配置...
});
  
```

#### 3. docker-compose.yml（使用 .env）

```yml
    services:
  backend:
    build:
      context: .
      dockerfile: backend.Dockerfile
    container_name: sim_backend
    command: uvicorn app.main:app --host 0.0.0.0 --port ${BACKEND_PORT:-8000} --reload
    volumes:
      - ./backend/app:/code/app
      - ./backend/data:/code/data
      - ./linglong:/code/linglong
      - /code/linglong/node_modules
    environment:
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - ASTRO_CONTENT_PATH=${ASTRO_CONTENT_PATH:-/code/linglong/src/contents/posts}
      - ASTRO_PROJECT_PATH=${ASTRO_PROJECT_PATH:-/code/linglong}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}

  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: sim_nginx
    ports:
      - "${NGINX_PORT:-8080}:80"
    volumes:
      - ./linglong/dist:/usr/share/nginx/html
    depends_on:
      - backend

networks:
  default:
    name: blog_network
  
```

### 2.5 使用环境配置

#### 开发环境：

```bash
# 1. 使用默认 .env
docker-compose up -d

# 2. 或指定开发环境
docker-compose --env-file .env up -d

# 3. 前端开发
cd linglong
pnpm run dev  # 自动加载 linglong/.env
  
```

#### 生产环境：

```bash
# 1. 使用生产环境配置
docker-compose --env-file .env.production up -d

# 2. 前端构建（生产模式）
cd linglong
pnpm run build  # 自动加载 linglong/.env.production
  
```

#### 树莓派部署：

```
# 1. 复制 .env.production 并修改
cp .env.production .env.raspberry-pi
# 编辑 .env.raspberry-pi，修改域名、密钥等

# 2. 传输到树莓派
scp -r webTest/ pi@raspberry-pi:/home/pi/

# 3. 在树莓派上启动
ssh pi@raspberry-pi
cd /home/pi/webTest
docker-compose --env-file .env.raspberry-pi up -d
  
```

------



### 三、.gitignore 配置

```
# ========== 环境变量 ==========
.env
.env.local
.env.*.local
.env.production  # 生产环境配置不要提交

# ========== 前端 ==========
linglong/node_modules/
linglong/dist/
linglong/.astro/
linglong/.env
linglong/.env.production

# ========== 后端 ==========
backend/__pycache__/
backend/*.pyc
backend/data/*.db
backend/data/*.db-shm
backend/data/*.db-wal
backend/logs/

# ========== Docker ==========
*.log

# ========== IDE ==========
.vscode/
.idea/
*.swp
*.swo

# ========== OS ==========
.DS_Store
Thumbs.db
  
```

------



### 四、自动化重命名脚本

创建一个 PowerShell 脚本自动完成重命名：

#### rename-yukina-to-linglong.ps1

```bash
# 博客项目重命名脚本：yukina → linglong

Write-Host "开始重命名项目：yukina → linglong" -ForegroundColor Green

# 1. 停止容器
Write-Host "`n1. 停止 Docker 容器..." -ForegroundColor Yellow
docker-compose down

# 2. 重命名目录
Write-Host "`n2. 重命名项目目录..." -ForegroundColor Yellow
if (Test-Path "yukina") {
    Rename-Item -Path "yukina" -NewName "linglong"
    Write-Host "   ✓ yukina/ → linglong/" -ForegroundColor Green
} else {
    Write-Host "   ! 目录 yukina 不存在，跳过" -ForegroundColor Red
}

# 3. 重命名配置文件
Write-Host "`n3. 重命名配置文件..." -ForegroundColor Yellow
if (Test-Path "linglong/yukina.config.ts") {
    Rename-Item -Path "linglong/yukina.config.ts" -NewName "linglong.config.ts"
    Write-Host "   ✓ yukina.config.ts → linglong.config.ts" -ForegroundColor Green
}

# 4. 批量替换文件内容
Write-Host "`n4. 替换文件内容中的 'yukina' 为 'linglong'..." -ForegroundColor Yellow

$files = @(
    "docker-compose.yml",
    "backend.Dockerfile",
    "backend/docker-compose.yml",
    "backend/app/core/config.py",
    "linglong/package.json",
    "linglong/astro.config.mjs"
)

foreach ($file in $files) {
    if (Test-Path $file) {
        (Get-Content $file) -replace 'yukina', 'linglong' | Set-Content $file
        Write-Host "   ✓ $file" -ForegroundColor Green
    } else {
        Write-Host "   ! $file 不存在" -ForegroundColor Red
    }
}

# 5. 替换 TypeScript/JavaScript 文件中的导入
Write-Host "`n5. 替换前端文件中的导入..." -ForegroundColor Yellow
$tsFiles = Get-ChildItem -Path "linglong/src" -Recurse -Include *.ts,*.tsx,*.astro,*.js,*.jsx
foreach ($file in $tsFiles) {
    $content = Get-Content $file.FullName -Raw
    if ($content -match 'yukina\.config') {
        $content -replace 'yukina\.config', 'linglong.config' | Set-Content $file.FullName
        Write-Host "   ✓ $($file.Name)" -ForegroundColor Green
    }
}

# 6. 替换变量名
Write-Host "`n6. 替换配置变量名..." -ForegroundColor Yellow
$configFiles = Get-ChildItem -Path "linglong" -Recurse -Include *.ts,*.astro
foreach ($file in $configFiles) {
    $content = Get-Content $file.FullName -Raw
    if ($content -match 'YukinaConfig') {
        $content -replace 'YukinaConfig', 'LinglongConfig' | Set-Content $file.FullName
        Write-Host "   ✓ $($file.Name)" -ForegroundColor Green
    }
}

Write-Host "`n✓ 重命名完成！" -ForegroundColor Green
Write-Host "`n请检查以下文件是否需要手动调整：" -ForegroundColor Yellow
Write-Host "  - linglong/linglong.config.ts"
Write-Host "  - linglong/package.json"
Write-Host "  - linglong/astro.config.mjs"
Write-Host "`n下一步：" -ForegroundColor Cyan
Write-Host "  1. 重新构建前端：cd linglong && pnpm install && pnpm run build"
Write-Host "  2. 启动容器：docker-compose up -d --build"
  
```

**使用方法：**

```
# 在项目根目录执行
.\rename-yukina-to-linglong.ps1
  
```

------



### 五、验证清单

重命名完成后，按以下清单验证：

#### ========== 文件检查 ==========

- 目录 linglong/ 存在
- 配置文件 linglong/linglong.config.ts 存在
- package.json 中 "name": "linglong"
- astro.config.mjs 导入 linglong.config

#### ========== 构建测试 ==========

- cd linglong && pnpm install  # 无错误
- pnpm run build  # 构建成功
- dist/ 目录生成

#### ========== Docker 测试 ==========

- docker-compose up -d --build  # 构建成功
- docker ps  # 两个容器运行
- docker-compose logs  # 无错误日志

#### ========== 功能测试 ==========

- http://localhost:8080  # 首页正常

- http://localhost:8080/docs  # API 文档正常

- http://localhost:8080/admin/login  # 管理面板正常

  编辑功能正常

------



这样你就有了完整的环境变量配置方案！使用 .env 文件的好处是：

1. **环境隔离**：开发和生产环境配置分离
2. **安全性**：敏感信息（JWT密钥）不提交到版本库
3. **灵活性**：不同环境可以使用不同配置
4. **可维护性**：配置集中管理，易于修改